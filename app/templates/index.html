{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">All Courses</h2>

<!-- SORT FILTER -->
<form method="GET" class="row mb-4">

    <div class="col-md-4">
        <select name="sort" class="form-select">
            <option value="title"
                {% if sort_by == "title" %}selected{% endif %}>
                Alphabetical
            </option>

            <option value="instructor"
                {% if sort_by == "instructor" %}selected{% endif %}>
                Instructor
            </option>
        </select>
    </div>

    <div class="col-md-4">
        <select name="order" class="form-select">
            <option value="asc"
                {% if order == "asc" %}selected{% endif %}>
                Ascending
            </option>

            <option value="desc"
                {% if order == "desc" %}selected{% endif %}>
                Descending
            </option>
        </select>
    </div>

    <div class="col-md-4">
        <button class="btn btn-primary w-100">
            Apply
        </button>
    </div>

</form>

<div class="row">

{% for course in courses %}

<div class="col-md-4 mb-4">

    <div class="card h-100 shadow-sm">

        {% if course.thumbnail %}
            <img src="{{ course.thumbnail }}"
                 class="card-img-top"
                 style="height:200px; object-fit:cover;">
        {% endif %}

        <div class="card-body">

            <h5>{{ course.title }}</h5>
            <p>{{ course.description[:80] }}...</p>

            <p class="text-muted">
                Instructor: {{ course.instructor.username }}
            </p>

        </div>

        <div class="card-footer bg-white">

        {% if current_user.is_authenticated and current_user.role == "student" %}

            {% if course.id in enrolled_course_ids %}
                <a href="/unenroll/{{ course.id }}"
                   class="btn btn-outline-danger btn-sm w-100">
                   Enrolled
                </a>
            {% else %}
                <a href="/enroll/{{ course.id }}"
                   class="btn btn-primary btn-sm w-100">
                   Enroll
                </a>
            {% endif %}

        {% endif %}

        {% if current_user.is_authenticated
              and current_user.role == "instructor"
              and course.instructor_id == current_user.id %}

            <a href="/edit-course/{{ course.id }}"
               class="btn btn-warning btn-sm w-100 mb-2">
               Edit
            </a>

            <a href="/delete-course/{{ course.id }}"
                class="btn btn-danger btn-sm w-100">
                Delete
            </a>

        {% endif %}

        </div>

    </div>

</div>

{% endfor %}

</div>

{% endblock %}